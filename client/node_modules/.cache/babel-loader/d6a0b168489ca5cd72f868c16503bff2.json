{"ast":null,"code":"var _jsxFileName = \"/Users/wendy/Documents/IRONHACK/MODULE-3/Projet-3-HelpMate/help-mate-client/client/src/views/AdsDisplayed.jsx\";\nimport React, { useEffect, useState } from \"react\";\nimport APIHandler from \"../../src/api/APIHandler\";\nimport PreviewAd from \"../components/ad/PreviewAd\";\nimport TabsAd from \"../components/ad/TabsAds\";\nimport Map from \"../components/map/Map\";\nimport { LoadScript } from \"@react-google-maps/api\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faMapMarkedAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport '../styles/adsPreview.css';\nimport { withRouter } from \"react-router-dom\";\nexport default withRouter(function AdsDisplayed({\n  history,\n  location,\n  match,\n  adsSearched,\n  max\n}) {\n  const [ads, setAds] = useState([]);\n  const [locations, setLocations] = useState([]);\n  const [toggleMap, setToggleMap] = useState(false);\n  const [toggleFilters, setToggleFilters] = useState(false);\n  const [categorySelected, setCategorySelected] = useState('');\n  const [typeSelected, setTypeSelected] = useState('');\n  const [apiRes, setApiRes] = useState([]);\n  const [inputAddress, setInputAddress] = useState(\"Paris\");\n  const [latitude, setLatitude] = useState(48.8534);\n  const [longitude, setLongitude] = useState(2.3488);\n  const [maxDistance, setMaxDistance] = useState(10);\n  const isHome = location.pathname === '/';\n  console.log('ads', ads);\n\n  const changeMaxDistance = e => {\n    setMaxDistance(e.target.value);\n    console.log('max dist', e.target.value);\n  };\n\n  const handleinput = e => {\n    setInputAddress(e.target.value);\n  };\n\n  const handleSubmit = e => {\n    console.log('add', inputAddress);\n    e.preventDefault();\n    const geocoder = new window.google.maps.Geocoder();\n    geocoder.geocode({\n      address: inputAddress\n    }, (results, status) => {\n      if (status == \"OK\") {\n        console.log(results, \"this is results\");\n        const lat = results[0].geometry.location.lat();\n        const lng = results[0].geometry.location.lng();\n        console.log('results', lat, lng);\n        setLatitude(lat);\n        setLongitude(lng);\n      } else {\n        alert(\"Geocode was not successful for the following reason: \" + status);\n      }\n    });\n  };\n\n  function getUserlocation() {\n    console.log('youhou je veux ta localisation');\n    var infoWindow;\n    infoWindow = new window.google.maps.InfoWindow();\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        var pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        setLatitude(position.coords.latitude);\n        setLongitude(position.coords.longitude);\n        infoWindow.setPosition(pos);\n        infoWindow.setContent('Location found.');\n        console.log(\"voici ta localisation bitch\", position.coords.latitude, \",\", position.coords.longitude); // infoWindow.open(map);\n        // map.setCenter(pos);\n      }, function () {\n        window.handleLocationError(true); // map.getCenter()\n      });\n    } else {\n      // Browser doesn't support Geolocation\n      window.handleLocationError(false); // map.getCenter()\n    }\n  }\n\n  function distance(lat1, lon1, lat2, lon2) {\n    console.log('lat voulue', lat1);\n    console.log('lat comparée', lat2);\n    console.log('lng voulue', lon1);\n    console.log('lng comparée', lon2);\n\n    if (lat1 == lat2 && lon1 == lon2) {\n      return 0;\n    } else {\n      var radlat1 = Math.PI * lat1 / 180;\n      var radlat2 = Math.PI * lat2 / 180;\n      var theta = lon1 - lon2;\n      var radtheta = Math.PI * theta / 180;\n      var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\n      if (dist > 1) {\n        dist = 1;\n      }\n\n      dist = Math.acos(dist);\n      dist = dist * 180 / Math.PI;\n      dist = dist * 60 * 1.1515;\n      dist = dist * 1.609344;\n      console.log('dist', dist);\n      return dist;\n    }\n  }\n\n  const displayMap = () => {\n    setToggleMap(!toggleMap);\n  };\n\n  function displayFilters() {\n    setToggleFilters(!toggleFilters);\n  }\n\n  useEffect(() => {\n    if (max) {\n      const adsFiltered = ads.filter((ad, i) => i < max);\n      setAds(adsFiltered);\n    }\n\n    const query = location.search.replace(\"?search=\", \"\");\n    APIHandler.get(`ads/search?q=${query}`).then(apiRes => {\n      if (max) {\n        const adsFiltered = apiRes.data.dbRes.filter((ad, i) => i < max);\n        setAds(adsFiltered);\n      } else {\n        setAds(apiRes.data.dbRes);\n        setApiRes(apiRes.data.dbRes);\n      }\n    }).catch(err => console.error(err));\n  }, [location]);\n  useEffect(() => {\n    console.log('setlatitude', latitude, 'setlongitude', longitude);\n    console.log('max dist', maxDistance);\n    const newArray = apiRes.filter((ad, i) => ad.adType.includes(typeSelected) && ad.category.includes(categorySelected) && distance(latitude, longitude, ad.location.coordinates[1], ad.location.coordinates[0]) <= maxDistance); // console.log('filter type',typeArray);\n\n    setAds(newArray);\n  }, [typeSelected, categorySelected, maxDistance, latitude, longitude]);\n  useEffect(() => {\n    if (adsSearched && adsSearched.length !== 0) {\n      setAds(adsSearched);\n    }\n\n    const locationsArray = ads.map((ad, i) => ad.location.coordinates);\n    setLocations(locationsArray);\n  }, [adsSearched, ads]);\n\n  const handleCategories = e => {\n    setCategorySelected(e.target.id);\n    console.log('categorychanged', categorySelected);\n  };\n\n  const handleType = e => {\n    setTypeSelected(e.target.value);\n    console.log('type changed', typeSelected);\n  };\n\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, !isHome && React.createElement(TabsAd, {\n    getUserlocation: getUserlocation,\n    maxDistance: maxDistance,\n    changeMaxDistance: changeMaxDistance,\n    handleinput: handleinput,\n    handleSubmit: handleSubmit,\n    setCategorySelected: handleCategories,\n    setTypeSelected: handleType,\n    mapActive: toggleMap,\n    filtersActive: toggleFilters,\n    toggleFilters: displayFilters,\n    toggle: displayMap,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: toggleFilters ? \"withfilters\" : \"nofilter\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, !isHome && React.createElement(LoadScript, {\n    id: \"script-loader\",\n    googleMapsApiKey: process.env.REACT_APP_GOOGLE_APIKEY,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183\n    },\n    __self: this\n  }, toggleMap && React.createElement(Map, {\n    locations: locations,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"ads-preview-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, Boolean(ads.length) ? ads.map((ad, i) => React.createElement(PreviewAd, {\n    data: ad,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  })) : React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, \"Aucune annonce \\xE0 afficher...\"))));\n});","map":{"version":3,"sources":["/Users/wendy/Documents/IRONHACK/MODULE-3/Projet-3-HelpMate/help-mate-client/client/src/views/AdsDisplayed.jsx"],"names":["React","useEffect","useState","APIHandler","PreviewAd","TabsAd","Map","LoadScript","FontAwesomeIcon","faMapMarkedAlt","withRouter","AdsDisplayed","history","location","match","adsSearched","max","ads","setAds","locations","setLocations","toggleMap","setToggleMap","toggleFilters","setToggleFilters","categorySelected","setCategorySelected","typeSelected","setTypeSelected","apiRes","setApiRes","inputAddress","setInputAddress","latitude","setLatitude","longitude","setLongitude","maxDistance","setMaxDistance","isHome","pathname","console","log","changeMaxDistance","e","target","value","handleinput","handleSubmit","preventDefault","geocoder","window","google","maps","Geocoder","geocode","address","results","status","lat","geometry","lng","alert","getUserlocation","infoWindow","InfoWindow","navigator","geolocation","getCurrentPosition","position","pos","coords","setPosition","setContent","handleLocationError","distance","lat1","lon1","lat2","lon2","radlat1","Math","PI","radlat2","theta","radtheta","dist","sin","cos","acos","displayMap","displayFilters","adsFiltered","filter","ad","i","query","search","replace","get","then","data","dbRes","catch","err","error","newArray","adType","includes","category","coordinates","length","locationsArray","map","handleCategories","id","handleType","process","env","REACT_APP_GOOGLE_APIKEY","Boolean"],"mappings":"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","sourcesContent":["import React, { useEffect, useState} from \"react\";\nimport APIHandler from \"../../src/api/APIHandler\";\nimport PreviewAd from \"../components/ad/PreviewAd\";\nimport TabsAd from \"../components/ad/TabsAds\";\nimport Map from \"../components/map/Map\";\nimport { LoadScript } from \"@react-google-maps/api\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faMapMarkedAlt} from \"@fortawesome/free-solid-svg-icons\";\nimport '../styles/adsPreview.css'\nimport {withRouter} from \"react-router-dom\";\n\n\nexport default withRouter(function AdsDisplayed({ history, location, match, adsSearched, max }) {\n  const [ads, setAds] = useState([]);\n  const [locations, setLocations] = useState([]);\n  const [toggleMap, setToggleMap] = useState(false);\n  const [toggleFilters, setToggleFilters] = useState(false)\n  const [categorySelected, setCategorySelected] = useState('')\n  const [typeSelected, setTypeSelected]= useState('')\n  const [apiRes, setApiRes]= useState([])\n  const [inputAddress, setInputAddress] = useState(\"Paris\");\n  const [latitude, setLatitude] = useState(48.8534);\n  const [longitude, setLongitude] = useState(2.3488);\n  const [maxDistance, setMaxDistance] = useState(10);\n\n  const isHome = location.pathname === '/';\n  \n  console.log('ads', ads)\n  const changeMaxDistance = e => {\n    setMaxDistance(e.target.value)\n    console.log('max dist',e.target.value)\n  }\n  const handleinput =e =>{\n    setInputAddress (e.target.value)\n  }\n\n  const handleSubmit =e=>{\n    console.log('add', inputAddress)\n    e.preventDefault();\n    const geocoder = new window.google.maps.Geocoder();\n      geocoder.geocode({ address: inputAddress }, (results, status)=> {\n        if (status == \"OK\") {\n          console.log(results, \"this is results\");\n          const lat = results[0].geometry.location.lat();\n          const lng = results[0].geometry.location.lng();\n          console.log('results',lat, lng);\n          setLatitude(lat);\n          setLongitude(lng);\n        } else {\n          alert(\n            \"Geocode was not successful for the following reason: \" + status\n          );\n        }\n  })\n}\n  function getUserlocation (){\n    console.log('youhou je veux ta localisation')\n    var infoWindow;\n    infoWindow = new window.google.maps.InfoWindow;\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(function(position) {\n        var pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        setLatitude(position.coords.latitude);\n        setLongitude(position.coords.longitude);\n        infoWindow.setPosition(pos);\n        infoWindow.setContent('Location found.');\n        console.log(\"voici ta localisation bitch\",position.coords.latitude,\",\", position.coords.longitude)\n        // infoWindow.open(map);\n        // map.setCenter(pos);\n      }, function() {\n        window.handleLocationError(true);\n        // map.getCenter()\n      });\n    } else {\n      // Browser doesn't support Geolocation\n      window.handleLocationError(false);\n      // map.getCenter()\n    }\n  }\n  function distance(lat1, lon1, lat2, lon2) {\n    console.log('lat voulue', lat1);\n    console.log('lat comparée', lat2);\n    console.log('lng voulue', lon1);\n    console.log('lng comparée', lon2);\n    if ((lat1 == lat2) && (lon1 == lon2)) {\n      return 0;\n    }\n    else {\n      var radlat1 = Math.PI * lat1/180;\n      var radlat2 = Math.PI * lat2/180;\n      var theta = lon1-lon2;\n      var radtheta = Math.PI * theta/180;\n      var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n      if (dist > 1) {\n        dist = 1;\n      }\n      dist = Math.acos(dist);\n      dist = dist * 180/Math.PI;\n      dist = dist * 60 * 1.1515;\n      dist = dist * 1.609344\n      console.log('dist',dist)\n      return dist;\n    }\n  }\n\n  const displayMap = ()=> {\n    setToggleMap(!toggleMap)\n  }\n  function displayFilters(){\n    setToggleFilters(!toggleFilters)\n  }\n  \n  useEffect(() => {\n    if (max) {\n      const adsFiltered = ads.filter((ad,i) => i < max )\n      setAds(adsFiltered)\n    }\n    \n    const query = location.search.replace(\"?search=\", \"\");\n    APIHandler.get(`ads/search?q=${query}`)\n    .then(apiRes => {\n\n      if (max) {\n        const adsFiltered = apiRes.data.dbRes.filter((ad,i) => i < max )\n        setAds(adsFiltered)\n      } else {\n        setAds(apiRes.data.dbRes)\n        setApiRes(apiRes.data.dbRes)\n      }\n    })\n    .catch(err => console.error(err))\n  }, [location])\n\n  useEffect(()=>{\n    console.log('setlatitude', latitude, 'setlongitude', longitude)\n    console.log('max dist', maxDistance)\n      const newArray =  apiRes.filter((ad, i)=>(ad.adType.includes(typeSelected) && ad.category.includes(categorySelected) && distance(latitude, longitude, ad.location.coordinates[1],ad.location.coordinates[0])<=maxDistance))\n      // console.log('filter type',typeArray);\n      setAds(newArray)\n  },[typeSelected, categorySelected, maxDistance, latitude, longitude])\n\n  useEffect(()=>{\n    if(adsSearched && adsSearched.length!==0) {\n      setAds(adsSearched)\n    }\n    \n    const locationsArray = ads.map((ad, i)=>(ad.location.coordinates))\n    setLocations(locationsArray)\n  }, [adsSearched, ads])\n \n \n  const handleCategories =  e => {\n    setCategorySelected(e.target.id);\n    console.log('categorychanged', categorySelected)\n}\nconst handleType = e => {\nsetTypeSelected(e.target.value);\nconsole.log('type changed', typeSelected)\n}\n  return (\n    <div>\n      { \n        !isHome &&<TabsAd \n          getUserlocation={getUserlocation} \n          maxDistance={maxDistance} \n          changeMaxDistance= {changeMaxDistance} \n          handleinput={handleinput} \n          handleSubmit={handleSubmit} \n          setCategorySelected={handleCategories} \n          setTypeSelected={handleType} \n          mapActive={toggleMap} \n          filtersActive={toggleFilters} \n          toggleFilters={displayFilters} \n          toggle={displayMap}\n          />\n      }\n\n        <div className={toggleFilters?\"withfilters\": \"nofilter\"}>\n        {\n          !isHome && <LoadScript\n            id=\"script-loader\"\n            googleMapsApiKey={process.env.REACT_APP_GOOGLE_APIKEY}\n          >\n            {toggleMap && <Map locations={locations} />}\n          </LoadScript>\n        }\n        \n        <div className=\"ads-preview-container\">\n          {Boolean(ads.length) ? (\n            ads.map((ad, i) => <PreviewAd data={ad} />)\n          ) : (\n            <p>Aucune annonce à afficher...</p>\n          )}\n        </div>\n\n      </div>\n    </div>\n  )\n})\n"]},"metadata":{},"sourceType":"module"}